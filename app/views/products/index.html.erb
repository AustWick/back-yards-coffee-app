<div class="container padding-top">
  <h1>
    <span class="lobster-font">Products</span>
  </h1>
  <div class="row">
    <%@products.each do |product|%>
    <div class="col s12 m4">
      <div class="card medium">
        <div class="card-image">
          <img class="activator" img src="<%=product.images[0]%>">
        </div>

        <div class="card-content">
          <span class="card-title activator grey-text text-darken-4"><%=product.name%></span>
        </div>
      </a>

      <div class="card-reveal">
        <span class="card-title grey-text text-darken-4"><%=product.name%>
          <i class="material-icons right">close</i>
        </span>
        <div class="innercard">
          <p><%=product.description%></p>
          <p>Starting at
            <%=number_to_currency(product.skus.data[1].price.to_f / 100)%></p>
            <div class="section">
          <div class="row">
            <div class="col s6">
            <a href="/products/<%= product.id %>" class="btn-large btn-floating waves-effect waves-light botyred tooltipped" type="submit" name="action" data-delay="5" data-tooltip="More info"><i class="material-icons large">info_outline</i></a>
          </div>
          <div class="col s6">
            <a href="#" id="id<%=product.id%>" class="add btn-large
              btn-floating waves-effect waves-light botyred tooltipped" data-delay="5" data-tooltip="Add to cart"><i class="material-icons md-24">add_shopping_cart</i></a>
          </div>
          </div>
        </div>
        </div>
      </div>

    </div>
  </div>
  <%end%>

</div>
</div>

<script>

const addToCart = document.querySelectorAll('.add');

function buyForm(){
  const thisProdId = this.id.slice(2)

  $.ajax({
    type: 'GET',
    url: `/products/${thisProdId}`,
    success: (data) => {
      this.closest(".innercard").innerHTML = data
  },
    error: function() {},
      }).then(function(){
          console.log("helo")
          $(document).ready(function() {
          $('select').material_select();
        });
      })
}

  for(var i = 0; i<addToCart.length; i++){
    addToCart[i].addEventListener('click', buyForm);
  }

</script>
<script>
$(document).ready(function(){
    $('.tooltipped').tooltip({delay: 5});
  });

</script>
